## InnoDB 锁类型思维导图

![](https://user-gold-cdn.xitu.io/2019/8/2/16c52a7ec7a9591a?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

### 兼容性

**共享锁（S锁）：**

- 一个事务获取了共享锁，其他事务可以获取共享锁，不能获取排他锁
- 获取共享锁的事物只能进行读操作,不能进行写操作

**排他锁（X锁）：**

- 排他锁，又称为写锁、独占锁，是一种基本的锁类型。
- 若[事务](https://baike.baidu.com/item/事务)T对[数据对象](https://baike.baidu.com/item/数据对象)A加上X锁，则只允许T读取和修改A，其他任何事务都不能再对A加任何类型的锁，直到T释放A上的锁。这就保证了其他[事务](https://baike.baidu.com/item/事务)在T释放A上的锁之前不能再读取和修改A。。



### 加锁机制

乐观锁与悲观锁是两种**并发控制**的思想，可用于解决丢失更新问题。

**乐观锁**

- 每次去取数据，都很乐观，觉得不会出现并发问题。
- 因此，访问、处理数据每次都不上锁。
- 但是在更新的时候，再根据版本号或时间戳判断是否有冲突，有则处理，无则提交事务。

**悲观锁**

- 每次去取数据，很悲观，都觉得会被别人修改，会有并发问题。
- 因此，访问、处理数据前就加**排他锁**。
- 在整个数据处理过程中锁定数据，事务提交或回滚后才释放锁.



### 锁粒度

- **表锁：** 开销小，加锁快；锁定力度大，发生锁冲突概率高，并发度最低;不会出现死锁。
- **行锁：** 开销大，加锁慢；会出现死锁；锁定粒度小，发生锁冲突的概率低，并发度高。
- **页锁：** 开销和加锁速度介于表锁和行锁之间；会出现死锁；锁定粒度介于表锁和行锁之间，并发度一般



### 锁模式

- **记录锁：** 在行相应的索引记录上的锁，锁定一个行记录
- **gap锁：** 是在索引记录间歇上的锁,锁定一个区间
- **next-key锁：** 是记录锁和在此索引记录之前的gap上的锁的结合，锁定行记录+区间。
- **意向锁** 是为了支持多种粒度锁同时存在

### 参考资料

* 百度百科  排他锁:[https://baike.baidu.com/item/%E6%8E%92%E4%BB%96%E9%94%81/6878674?fr=aladdin](https://baike.baidu.com/item/排他锁/6878674?fr=aladdin)
* 百度百科  共享锁:[https://baike.baidu.com/item/%E5%85%B1%E4%BA%AB%E9%94%81](https://baike.baidu.com/item/共享锁)
* Jay_huaxiao :<<后端程序员必备：mysql数据库相关流程图/原理图>> :https://juejin.im/post/5d42f48cf265da03ab422e08?utm_source=gold_browser_extension

